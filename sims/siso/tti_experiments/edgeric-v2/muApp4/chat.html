<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nice HTTP Chat Interface</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#6ee7b7; --muted:#9aa6b2; --me:#183b3a; --you:#1a2938; --glass: rgba(255,255,255,0.04);
      --radius:14px; --shadow: 0 6px 24px rgba(2,6,23,0.6);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;color:#e6eef3;background:linear-gradient(180deg,#071025 0%,#081426 60%);}

    .app{max-width:980px;margin:28px auto;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:20px;padding:18px;box-shadow:var(--shadow);display:grid;grid-template-columns:320px 1fr;gap:18px}

    /* Sidebar */
    .sidebar{background:var(--card);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:12px;height:78vh}
    .logo{display:flex;align-items:center;gap:10px}
    .logo .dot{width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#7dd3fc);box-shadow:0 6px 18px rgba(102,126,234,0.12)}
    .conversations{overflow:auto;padding-right:6px;flex:1}
    .convo{padding:10px;border-radius:10px;display:flex;gap:10px;align-items:center;cursor:pointer}
    .convo:hover{background:var(--glass)}
    .avatar{width:38px;height:38px;border-radius:8px;background:linear-gradient(180deg,#0ea5a5,#0369a1);display:flex;align-items:center;justify-content:center;color:#081426;font-weight:700}
    .meta{flex:1}
    .name{font-weight:600}
    .last{font-size:13px;color:var(--muted)}
    .new-btn{padding:10px;border-radius:10px;background:linear-gradient(90deg,#0ea5a5,#6366f1);color:white;border:none;cursor:pointer}

    /* Main */
    .main{background:var(--card);border-radius:12px;padding:14px;display:flex;flex-direction:column;height:78vh}
    .main-header{display:flex;align-items:center;gap:12px;padding-bottom:6px;border-bottom:1px solid rgba(255,255,255,0.03)}
    .title{font-weight:700;font-size:18px}
    .messages{flex:1;overflow:auto;padding:18px;display:flex;flex-direction:column;gap:12px}

    .msg{max-width:78%;padding:12px;border-radius:12px;line-height:1.4}
    .msg.you{align-self:flex-start;background:linear-gradient(180deg,#0b2540,#062037);color:#dbeafe;border-top-left-radius:6px}
    .msg.me{align-self:flex-end;background:linear-gradient(180deg,#0b4139,#0b352f);color:white;border-top-right-radius:6px}
    .meta-row{display:flex;gap:8px;align-items:center;font-size:12px;color:var(--muted)}

    .composer{display:flex;gap:10px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.03)}
    .input{flex:1;display:flex;align-items:center;background:rgba(255,255,255,0.02);padding:10px;border-radius:12px}
    .input textarea{width:100%;border:0;background:transparent;color:inherit;resize:none;height:44px;font-size:14px;padding:6px;outline:none}
    .send{background:linear-gradient(90deg,#06b6d4,#7c3aed);border:0;color:white;padding:10px 14px;border-radius:12px;cursor:pointer}

    .typing{font-size:13px;color:var(--muted);display:flex;gap:6px;align-items:center}
    .dots span{display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--muted);animation:bl 1s infinite;opacity:0.45}
    .dots span:nth-child(2){animation-delay:0.15s}
    .dots span:nth-child(3){animation-delay:0.3s}
    @keyframes bl{0%{transform:translateY(0);opacity:0.4}50%{transform:translateY(-6px);opacity:1}100%{transform:translateY(0);opacity:0.4}}

    /* Mobile */
    @media (max-width:880px){.app{grid-template-columns:1fr;padding:12px}.sidebar{display:none;height:auto}.main{height:86vh}}
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="logo">
        <div class="dot">C</div>
        <div>
          <div style="font-weight:700">EdgeRIC Chat</div>
          <div style="font-size:13px;color:var(--muted)">Single-file demo • Serve it over any static host</div>
        </div>
      </div>

      <button class="new-btn" id="newConv">+ 5G optimizer</button>

      <div class="conversations" id="conversations">
        <!-- conversations are inserted here -->
      </div>
    </aside>

    <main class="main">
      <div class="main-header">
        <div style="display:flex;align-items:center;gap:12px">
          <div class="avatar">AI</div>
          <div>
            <div class="title" id="chatTitle">Welcome</div>
            <div style="font-size:13px;color:var(--muted)" id="chatSubtitle">A friendly HTTP-based chat UI</div>
          </div>
        </div>
        <div style="margin-left:auto;color:var(--muted);font-size:13px">Status: <span id="status">idle</span></div>
      </div>

      <div class="messages" id="messages">
        <!-- messages here -->
      </div>

      <div class="composer">
        <div class="input">
          <textarea id="promptInput" placeholder="Ask something... (Shift+Enter = newline, Enter = send)"></textarea>
        </div>
        <button class="send" id="sendBtn">Send</button>
      </div>

    </main>
  </div>

  <script>
    // Simple single-file chat UI that POSTs JSON to /api/chat
    // Expected backend: POST /api/chat {"message": "..."} -> {"reply":"..."}

    const conversationsEl = document.getElementById('conversations');
    const messagesEl = document.getElementById('messages');
    const statusEl = document.getElementById('status');
    const promptInput = document.getElementById('promptInput');
    const sendBtn = document.getElementById('sendBtn');

    const state = {
      convos: [],
      active: null
    };

    function makeId(){return Math.random().toString(36).slice(2,9)}

    function newConversation(){
      const id = makeId();
      const convo = {id, title:'5G optimizer', messages:[]};
      state.convos.unshift(convo);
      setActive(id);
      renderConvos();
    }

    function setActive(id){
      state.active = state.convos.find(c=>c.id===id);
      renderConvos();
      renderActive();
    }

    function renderConvos(){
      conversationsEl.innerHTML='';
      state.convos.forEach(c=>{
        const el = document.createElement('div');
        el.className='convo';
        el.innerHTML = `<div class='avatar'>${c.title.charAt(0)||'N'}</div><div class='meta'><div class='name'>${c.title}</div><div class='last'>${c.messages.length? c.messages[c.messages.length-1].text.slice(0,60): 'Empty'}</div></div>`;
        el.onclick = ()=>setActive(c.id);
        conversationsEl.appendChild(el);
      })
    }

    function renderActive(){
      messagesEl.innerHTML='';
      if(!state.active) return;
      document.getElementById('chatTitle').innerText = state.active.title;
      state.active.messages.forEach(m=>{
        const el = document.createElement('div');
        el.className = 'msg ' + (m.from==='me' ? 'me':'you');
        el.innerHTML = `<div>${escapeHtml(m.text)}</div><div class='meta-row'>${m.from==='me' ? 'You' : 'AI'} • ${new Date(m.ts).toLocaleTimeString()}</div>`;
        messagesEl.appendChild(el);
      })
      // scroll to bottom
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function escapeHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

    async function sendMessage(){
      const text = promptInput.value.trim();
      if(!text || !state.active) return;
      const msg = {from:'me', text, ts:Date.now()};
      state.active.messages.push(msg);
      promptInput.value='';
      renderActive();

      // add typing indicator
      const typing = {from:'you', text:'', ts:Date.now(), typing:true};
      state.active.messages.push(typing);
      renderActive();
      statusEl.innerText = 'sending...';

      try{
        // send to backend
        const res = await fetch('/api/chat', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:text})});
        if(!res.ok){ throw new Error('bad response'); }
        // expect JSON {reply: '...'}
        const data = await res.json();
        // replace typing with real reply
        state.active.messages = state.active.messages.filter(m=>!m.typing);
        state.active.messages.push({from:'you', text:data.reply||'(no reply)', ts:Date.now()});
        statusEl.innerText = 'idle';
        renderActive();
      }catch(err){
        // show error
        state.active.messages = state.active.messages.filter(m=>!m.typing);
        state.active.messages.push({from:'you', text:'(error contacting server)', ts:Date.now()});
        statusEl.innerText = 'error';
        renderActive();
        console.error(err);
      }
    }

    // events
    sendBtn.onclick = sendMessage;
    promptInput.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); }
    });

    document.getElementById('newConv').onclick = newConversation;

    // bootstrap with a conversation
    newConversation();
    // helpful tip: you can wire the backend to /api/chat and return {reply: "..."}
  </script>
</body>
</html>
